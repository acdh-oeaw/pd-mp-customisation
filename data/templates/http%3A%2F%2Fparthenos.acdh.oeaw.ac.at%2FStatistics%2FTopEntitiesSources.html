<ol class="page-breadcrumb">
  <li>
    <mp-link title="Home" url="/">Home</mp-link>
  </li>
  <li>
    <mp-link title="Statistics Overview" url="p:Statistics">Statistics</mp-link>
  </li>          
  <li class="active">
    <mp-label iri='[[this]]'>Classes</mp-label>
  </li>
</ol>


<div class="page">
 
  <div class="page__body">
    <h1>Top entities by providers</h1>
    <p>This gives an overview on the number of entities divided by the top classes of interest and the providers or sources (the different infrastructures providing data to Parthenos). This overview is further distinguished by the type of identifier (starting with <code>http</code> or <code>urn</code>, (roughly) indicating if the entity was created intentionally in the mapping process, or is an automatically generated entity because required by the PEM. </p>

            <semantic-table
             query='[[getQueryString "https://parthenos.acdh-dev.oeaw.ac.at/container/queryTemplateContainer/nNqUdqRddmDhzPKmMAJxCVPfvrLqQjQRbjulNFqh" Key='"urn"' ]]'
             number-of-displayed-rows=50
             column-configuration='[
               {"variableName":"src", "displayName":"Source"}, 
              {"variableName":"key", "displayName":"Key"},                
    					{	"displayName": "Actors", 
    						"cellTemplate": "{{>sparqlCell maintype=\"crm:E39_Actor\" cnt=actorcnt.value}}" 
    						},
              {	"displayName": "Datasets", 
    						"cellTemplate": "{{>sparqlCell maintype=\"pe:PE18_Dataset\" cnt=datacnt.value}}" 
    						},
              {	"displayName": "Services", 
    						"cellTemplate": "{{>sparqlCell maintype=\"pe:PE1_Service\" cnt=servicecnt.value}}" 
    						},
              {	"displayName": "Software", 
    						"cellTemplate": "{{>sparqlCell maintype=\"crmdig:D14_Software\" cnt=softwarecnt.value}}" 
    						},
              {	"displayName": "Places", 
    						"cellTemplate": "{{>sparqlCell maintype=\"crm:E53_Place\" cnt=placecnt.value}}" 
    						},
              {	"displayName": "Project", 
    						"cellTemplate": "{{>sparqlCell maintype=\"pe:PE35_Project\" cnt=projectcnt.value}}" 
    						}
             ]'
           >
              <template id="sparqlCell" >
                <div><mp-link target="_blank" url="/sparql" urlqueryparam-query='PREFIX acdh: <http://acdh.oeaw.ac.at/>
                    SELECT DISTINCT ?s ?sourceLabel ?key ?maintype WHERE {
                           BIND ("{{key.value}}" as ?key ).
                           BIND ({{maintype}} as ?maintype).

                                    GRAPH ?g { ?s a ?t .}
                                          ?t rdfs:subClassOf* ?maintype.    

                                              FILTER strstarts(lcase(str(?s)), ?key). 
                                    GRAPH <http://www.d-net.research-infrastructures.eu/provenance/graph> { 
                              ?g <http://www.d-net.research-infrastructures.eu/provenance/collectedFrom> ?source .
                              ?source <http://www.d-net.research-infrastructures.eu/provenance/isApiOf> ?sourceLabel .
                                        FILTER (?sourceLabel = "{{src.value}}")
                            }
                                }										
                    LIMIT 10'>{{cnt}}</mp-link></div>
              </template>
           </semantic-table>

    <!--
    <semantic-table
             query='
PREFIX acdh: <http://acdh.oeaw.ac.at/>
SELECT ?src ?key ?actorcnt ?datacnt ?servicecnt ?softwarecnt ?placecnt ?projectcnt WHERE  { BIND ("http" as ?key).
                                   {SELECT DISTINCT ?src WHERE {[] acdh:hasSource ?src;} }
                                   OPTIONAL {             
                                       ?aggactor a acdh:Aggregate;
                                           acdh:hasClass <http://www.cidoc-crm.org/cidoc-crm/E39_Actor>;
                                           acdh:hasSource ?src;
                                           acdh:hasKey ?key;
                                           acdh:hasValue ?actorcnt.
                                    }
                                   OPTIONAL {
                                     ?aggdata a acdh:Aggregate;
                                           acdh:hasClass <http://parthenos.d4science.org/CRMext/CRMpe.rdfs/PE18_Dataset>;
                                           acdh:hasSource ?src;
                                           acdh:hasKey ?key;
                                           acdh:hasValue ?datacnt.
                                            }
                                   OPTIONAL {
                                     ?aggservice a acdh:Aggregate;
                                           acdh:hasClass <http://parthenos.d4science.org/CRMext/CRMpe.rdfs/PE1_Service>;
                                           acdh:hasSource ?src;
                                           acdh:hasKey ?key;
                                           acdh:hasValue ?servicecnt.
                                            }
                                                        OPTIONAL {
                                     ?aggsoftware a acdh:Aggregate;
                                           acdh:hasClass <http://www.ics.forth.gr/isl/CRMext/CRMdig.rdfs/D14_Software>;
                                           acdh:hasSource ?src;
                                           acdh:hasKey ?key;
                                           acdh:hasValue ?softwarecnt.
                                            }
                                   
                                   OPTIONAL {
                                     ?aggplace a acdh:Aggregate;
                                           acdh:hasClass <http://www.cidoc-crm.org/cidoc-crm/E53_Place>;
                                           acdh:hasSource ?src;
                                           acdh:hasKey ?key;
                                           acdh:hasValue ?placecnt.
                                            }
                                         OPTIONAL {
                                     ?aggproject a acdh:Aggregate;
                                           acdh:hasClass <http://parthenos.d4science.org/CRMext/CRMpe.rdfs/PE35_Project>;
                                           acdh:hasSource ?src;
                                           acdh:hasKey ?key;
                                           acdh:hasValue ?projectcnt.
                                            }
}
ORDER BY ?src
'
             number-of-displayed-rows=50
             
           >
           </semantic-table>

    
    <h2>for debugging</h2>
    <p>the same query as above, however included through <code>getQueryString</code>helper and passed on the <code>key</code> argument.
    Strangely a response is returned, but without the numbers</p>
    <semantic-table
             query='[[getQueryString "https://parthenos.acdh-dev.oeaw.ac.at/container/queryTemplateContainer/topentitiessources" pKey='"http"' ]]'
             number-of-displayed-rows=50
             
           >
           </semantic-table>

-->   
  </div>
  
    </div>